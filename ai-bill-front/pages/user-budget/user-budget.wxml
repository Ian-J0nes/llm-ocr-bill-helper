<!--pages/user-buget/user-buget.wxml-->
<view class="budget-container">
  <view class="header">
    <text class="title">预算设置</text>
    <text class="subtitle">合理规划支出，轻松掌握财务</text>
  </view>
  
  <!-- 现有预算列表 -->
  <view class="budget-list-section" wx:if="{{budgets.length > 0}}">
    <view class="section-title">当前预算</view>
    <view class="budget-list">
      <view class="budget-item" wx:for="{{budgets}}" wx:key="id">
        <view class="budget-info">
          <text class="budget-type">{{item.budgetType}}</text>
          <text class="budget-amount">¥{{item.budgetAmount}}</text>
          <text class="budget-date">{{item.startDate}} 至 {{item.endDate}}</text>
          <text class="budget-alert" wx:if="{{item.alertThreshold}}">预警阈值: {{item.alertThreshold}}%</text>
        </view>
        <view class="budget-actions">
          <text class="edit-btn" data-id="{{item.id}}" bindtap="editBudget">编辑</text>
          <text class="delete-btn" data-id="{{item.id}}" bindtap="deleteBudget">删除</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- 添加新预算按钮 -->
  <view class="add-btn-section" wx:if="{{!showForm}}">
    <button class="add-btn" bindtap="showBudgetForm">添加新预算</button>
  </view>
  
  <!-- 预算表单 - 默认隐藏 -->
  <view class="form-section" wx:if="{{showForm}}">
    <!-- 预算类型选择 -->
    <view class="form-item">
      <text class="label">预算类型</text>
      <view class="picker-wrapper">
        <picker bindchange="handleTypeChange" value="{{typeIndex}}" range="{{budgetTypes}}" range-key="name">
          <view class="picker-content">
            <view class="picker-text">{{budgetTypes[typeIndex].name}}</view>
            <view class="arrow">▼</view>
          </view>
        </picker>
      </view>
    </view>
    
    <!-- 预算金额 -->
    <view class="form-item">
      <text class="label">预算金额</text>
      <view class="input-wrapper">
        <input class="budget-input" type="digit" placeholder="请输入预算金额" value="{{amount}}" bindinput="handleAmountChange" />
        <text class="unit">元</text>
      </view>
    </view>
    
    <!-- 预警阈值 -->
    <view class="form-item">
      <text class="label">预警阈值 ({{alertThreshold}}%)</text>
      <view class="slider-wrapper">
        <slider min="10" max="100" value="{{alertThreshold}}" activeColor="#ff9800" backgroundColor="#e0e0e0" block-size="20" block-color="#4caf50" bindchange="handleAlertThresholdChange" show-value="{{false}}" />
      </view>
      <text class="hint-text">当支出达到预算的设定百分比时将发出预警</text>
    </view>
    
    <!-- 预算周期 - 开始日期 -->
    <view class="form-item">
      <text class="label">开始日期</text>
      <view class="picker-wrapper">
        <picker mode="date" value="{{startDate}}" start="{{minDate}}" end="{{maxDate}}" bindchange="handleStartDateChange">
          <view class="picker-content">
            <view class="picker-text">{{startDate}}</view>
            <view class="arrow">▼</view>
          </view>
        </picker>
      </view>
    </view>
    
    <!-- 预算周期 - 结束日期 -->
    <view class="form-item">
      <text class="label">结束日期</text>
      <view class="picker-wrapper">
        <picker mode="date" value="{{endDate}}" start="{{startDate}}" end="{{maxDate}}" bindchange="handleEndDateChange">
          <view class="picker-content">
            <view class="picker-text">{{endDate}}</view>
            <view class="arrow">▼</view>
          </view>
        </picker>
      </view>
    </view>
    
    <!-- 按钮区 -->
    <view class="btn-section">
      <button class="save-btn" bindtap="saveBudget">保存预算</button>
      <button class="cancel-btn" bindtap="hideBudgetForm">取消</button>
    </view>
  </view>
  
  <!-- 无预算时的提示 -->
  <view class="no-budget-tip" wx:if="{{budgets.length === 0 && !showForm}}">
    <text class="tip-text">您还没有设置任何预算</text>
    <text class="tip-subtext">制定预算可以帮助您更好地掌握财务</text>
  </view>
</view>